# LighterAccount DApp ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

LighterAccount äº¤äº’é¡µé¢æä¾›äº†ä¸€ä¸ªç”¨æˆ·å‹å¥½çš„ç•Œé¢ï¼Œç”¨äºä¸ LighterAccount æ™ºèƒ½åˆçº¦äº¤äº’ã€‚

## åŠŸèƒ½

### 1. ğŸ« åˆ›å»ºè´¦æˆ· (createAccount)

**åŠŸèƒ½è¯´æ˜**ï¼š
- ç§Ÿå€Ÿä¸€ä¸ªç¥¨åˆ¸ NFT
- è‡ªåŠ¨åˆ›å»ºå¯¹åº”çš„ Token Bound Account (TBA)
- ç»‘å®š Nostr å…¬é’¥åˆ°ç¥¨åˆ¸

**å‚æ•°**ï¼š
- `recipient`: æ¥æ”¶è€…åœ°å€ï¼ˆç¥¨åˆ¸æ‰€æœ‰è€…ï¼‰
- `nostrPubKey`: Nostr å…¬é’¥ï¼ˆ32 å­—èŠ‚åå…­è¿›åˆ¶ï¼‰
- `rentAmount`: æ”¯ä»˜çš„ç§Ÿé‡‘ï¼ˆETHï¼‰

**ä½¿ç”¨æ­¥éª¤**ï¼š
1. å¡«å†™æ¥æ”¶è€…åœ°å€ï¼ˆé»˜è®¤ä¸ºå½“å‰é’±åŒ…åœ°å€ï¼‰
2. å¡«å†™ Nostr å…¬é’¥ï¼ˆ64 ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ï¼Œå¦‚ï¼š`1234567890abcdef...`ï¼‰
3. å¡«å†™æ”¯ä»˜é‡‘é¢ï¼ˆè‡³å°‘ç­‰äº rentPriceï¼‰
4. ç‚¹å‡»"åˆ›å»ºè´¦æˆ·"æŒ‰é’®
5. åœ¨é’±åŒ…ä¸­ç¡®è®¤äº¤æ˜“
6. äº¤æ˜“æˆåŠŸåä¼šè¿”å› tokenId å’Œ TBA åœ°å€

**ç¤ºä¾‹ Nostr å…¬é’¥**ï¼š
```
0x1234567890abcdef1234567890abcdef1234567890abcdef1234567890abcdef
```

### 2. ğŸ—‘ï¸ é”€æ¯è´¦æˆ· (destroyAccount)

**åŠŸèƒ½è¯´æ˜**ï¼š
- é”€æ¯ç¥¨åˆ¸ NFT
- é€€è¿˜ç§Ÿé‡‘åˆ°æŒ‡å®šåœ°å€

**å‚æ•°**ï¼š
- `tokenId`: è¦é”€æ¯çš„ç¥¨åˆ¸ ID
- `recipient`: æ¥æ”¶é€€æ¬¾çš„åœ°å€

**ä½¿ç”¨æ­¥éª¤**ï¼š
1. å¡«å†™è¦é”€æ¯çš„ Token ID
2. å¡«å†™é€€æ¬¾æ¥æ”¶åœ°å€
3. âš ï¸ æ³¨æ„ï¼šæ­¤æ“ä½œå¿…é¡»ä» TBAï¼ˆToken Bound Accountï¼‰è°ƒç”¨
4. ç‚¹å‡»"é”€æ¯è´¦æˆ·"æŒ‰é’®
5. ç¡®è®¤äº¤æ˜“

**é‡è¦æç¤º**ï¼š
- æ­¤åŠŸèƒ½éœ€è¦ç‰¹æ®Šè®¾ç½®ï¼ˆä» TBA è°ƒç”¨ï¼‰
- æ™®é€šç”¨æˆ·é€šå¸¸æ— æ³•ç›´æ¥è°ƒç”¨
- éœ€è¦é€šè¿‡ TBA çš„ execute åŠŸèƒ½æ¥è°ƒç”¨

### 3. â¬†ï¸ å‡çº§é…é¢ (upgradeQuota)

**åŠŸèƒ½è¯´æ˜**ï¼š
- ä¸ºå·²æœ‰çš„ç¥¨åˆ¸è´¦æˆ·å¢åŠ é…é¢
- é€šè¿‡æ”¯ä»˜é¢å¤–ç§Ÿé‡‘æ¥æå‡é…é¢

**å‚æ•°**ï¼š
- `tokenId`: è¦å‡çº§çš„ç¥¨åˆ¸ ID
- `upgradeAmount`: æ”¯ä»˜çš„é‡‘é¢ï¼ˆETHï¼‰

**ä½¿ç”¨æ­¥éª¤**ï¼š
1. å¡«å†™è¦å‡çº§çš„ Token ID
2. å¡«å†™æ”¯ä»˜é‡‘é¢
3. ç‚¹å‡»"å‡çº§é…é¢"æŒ‰é’®
4. ç¡®è®¤äº¤æ˜“
5. é…é¢ä¼šæ ¹æ®æ”¯ä»˜é‡‘é¢å¢åŠ 

**é…é¢è®¡ç®—**ï¼š
```
æ–°é…é¢ = (å·²æ”¯ä»˜æ€»é¢ + æœ¬æ¬¡æ”¯ä»˜) / rentPrice
```

---

## å¯åŠ¨ DApp

### 1. å®‰è£…ä¾èµ–

```bash
cd dapp
npm install
```

### 2. å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
npm start
```

åº”ç”¨å°†åœ¨ http://localhost:3000 å¯åŠ¨

### 3. æ„å»ºç”Ÿäº§ç‰ˆæœ¬

```bash
npm run build
```

### 4. éƒ¨ç½²ç”Ÿäº§ç‰ˆæœ¬

```bash
npm run serve
```

---

## ä½¿ç”¨æµç¨‹

### ç¬¬ä¸€æ­¥ï¼šè¿æ¥é’±åŒ…

1. æ‰“å¼€ http://localhost:3000
2. ç‚¹å‡»"è¿æ¥é’±åŒ…"æŒ‰é’®
3. é€‰æ‹© MetaMask æˆ–å…¶ä»–å…¼å®¹é’±åŒ…
4. æˆæƒè¿æ¥

### ç¬¬äºŒæ­¥ï¼šè¾“å…¥åˆçº¦åœ°å€

1. åˆ‡æ¢åˆ°"ğŸ« LighterAccount"æ ‡ç­¾é¡µ
2. åœ¨"LighterAccount åˆçº¦åœ°å€"è¾“å…¥æ¡†ä¸­è¾“å…¥å·²éƒ¨ç½²çš„ LighterAccount åˆçº¦åœ°å€
3. åˆçº¦ä¿¡æ¯ä¼šè‡ªåŠ¨åŠ è½½æ˜¾ç¤º

### ç¬¬ä¸‰æ­¥ï¼šä½¿ç”¨åŠŸèƒ½

æ ¹æ®éœ€æ±‚é€‰æ‹©å¯¹åº”çš„åŠŸèƒ½ï¼š

#### åˆ›å»ºè´¦æˆ·
1. åˆ‡æ¢åˆ°"ğŸ« åˆ›å»ºè´¦æˆ·"å­æ ‡ç­¾
2. å¡«å†™æ¥æ”¶è€…åœ°å€
3. å¡«å†™ Nostr å…¬é’¥
4. å¡«å†™æ”¯ä»˜é‡‘é¢
5. ç‚¹å‡»"åˆ›å»ºè´¦æˆ·"
6. åœ¨é’±åŒ…ä¸­ç¡®è®¤äº¤æ˜“

#### é”€æ¯è´¦æˆ·
1. åˆ‡æ¢åˆ°"ğŸ—‘ï¸ é”€æ¯è´¦æˆ·"å­æ ‡ç­¾
2. å¡«å†™ Token ID
3. å¡«å†™é€€æ¬¾æ¥æ”¶åœ°å€
4. ç‚¹å‡»"é”€æ¯è´¦æˆ·"
5. ç¡®è®¤äº¤æ˜“

#### å‡çº§é…é¢
1. åˆ‡æ¢åˆ°"â¬†ï¸ å‡çº§é…é¢"å­æ ‡ç­¾
2. å¡«å†™ Token ID
3. å¡«å†™æ”¯ä»˜é‡‘é¢
4. ç‚¹å‡»"å‡çº§é…é¢"
5. ç¡®è®¤äº¤æ˜“

---

## åˆçº¦éƒ¨ç½²

åœ¨ä½¿ç”¨ DApp ä¹‹å‰ï¼Œéœ€è¦å…ˆéƒ¨ç½² LighterAccount åˆçº¦ï¼š

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•
npx hardhat run scripts/deploy-with-official-accountv3.ts --network <network-name>
```

éƒ¨ç½²å®Œæˆåï¼Œè®°å½• LighterAccount åˆçº¦åœ°å€ï¼Œç”¨äº DApp ä¸­è¾“å…¥ã€‚

---

## ç½‘ç»œé…ç½®

### æœ¬åœ°å¼€å‘ç½‘ç»œ

```
Network: Hardhat Local
Chain ID: 31337
RPC URL: http://localhost:8545
```

### Sepolia æµ‹è¯•ç½‘

```
Network: Sepolia
Chain ID: 11155111
RPC URL: https://rpc.sepolia.org
```

åœ¨é’±åŒ…ä¸­æ·»åŠ å¯¹åº”ç½‘ç»œï¼Œç¡®ä¿ DApp è¿æ¥åˆ°æ­£ç¡®çš„ç½‘ç»œã€‚

---

## æ•…éšœæ’æŸ¥

### 1. "è¯·å¡«å†™æ‰€æœ‰å¿…éœ€å­—æ®µ"

- æ£€æŸ¥æ‰€æœ‰è¾“å…¥æ¡†æ˜¯å¦å¡«å†™
- æ¥æ”¶è€…åœ°å€å¿…é¡»æ˜¯æœ‰æ•ˆçš„ä»¥å¤ªåŠåœ°å€
- Nostr å…¬é’¥å¿…é¡»æ˜¯ 64 ä¸ªåå…­è¿›åˆ¶å­—ç¬¦ï¼ˆ32 å­—èŠ‚ï¼‰

### 2. "InsufficientPayment"

- æ”¯ä»˜é‡‘é¢å¿…é¡»è‡³å°‘ç­‰äº rentPrice
- æ£€æŸ¥åˆçº¦çš„å½“å‰ rentPrice

### 3. "InvalidSender" (é”€æ¯è´¦æˆ·æ—¶)

- destroyAccount å¿…é¡»ä» TBA è°ƒç”¨
- æ™®é€šç”¨æˆ·æ— æ³•ç›´æ¥è°ƒç”¨æ­¤åŠŸèƒ½
- éœ€è¦é€šè¿‡ TBA çš„ execute åŠŸèƒ½

### 4. é’±åŒ…è¿æ¥é—®é¢˜

- ç¡®ä¿å·²å®‰è£… MetaMask
- ç¡®ä¿é’±åŒ…å·²è§£é”
- ç¡®ä¿è¿æ¥åˆ°æ­£ç¡®çš„ç½‘ç»œ

### 5. åˆçº¦åœ°å€æ— æ•ˆ

- æ£€æŸ¥è¾“å…¥çš„åˆçº¦åœ°å€æ˜¯å¦æ­£ç¡®
- ç¡®ä¿åˆçº¦å·²åœ¨å½“å‰ç½‘ç»œéƒ¨ç½²
- å¯ä»¥åœ¨åŒºå—æµè§ˆå™¨ä¸­éªŒè¯åˆçº¦

---

## æŠ€æœ¯æ ˆ

- **React** 19.2.0
- **TypeScript** 5.9.3
- **Wagmi** 2.17.5 (ä»¥å¤ªåŠäº¤äº’)
- **Viem** 2.37.12 (ä»¥å¤ªåŠå·¥å…·)
- **TanStack Query** 5.90.2 (çŠ¶æ€ç®¡ç†)

---

## å¼€å‘è¯´æ˜

### æ–‡ä»¶ç»“æ„

```
dapp/src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ LighterAccountInteraction.tsx    # LighterAccount äº¤äº’ç»„ä»¶
â”‚   â”œâ”€â”€ LighterAccountInteraction.css    # æ ·å¼
â”‚   â”œâ”€â”€ ContractInteraction.tsx          # åŸæœ‰ç»„ä»¶
â”‚   â”œâ”€â”€ BuyerInteraction.tsx             # åŸæœ‰ç»„ä»¶
â”‚   â””â”€â”€ WalletConnectButton.tsx          # é’±åŒ…è¿æ¥æŒ‰é’®
â”œâ”€â”€ abis/
â”‚   â””â”€â”€ LighterAccount.json              # LighterAccount ABI
â”œâ”€â”€ App.tsx                               # ä¸»åº”ç”¨ï¼ˆå·²æ›´æ–°ï¼‰
â””â”€â”€ App.css                               # åº”ç”¨æ ·å¼
```

### æ·»åŠ æ–°åŠŸèƒ½

å¦‚æœéœ€è¦æ·»åŠ æ›´å¤š LighterAccount çš„åŠŸèƒ½ï¼š

1. åœ¨ `LighterAccountInteraction.tsx` ä¸­æ·»åŠ æ–°çš„è¡¨å•å’Œå¤„ç†å‡½æ•°
2. æ·»åŠ æ–°çš„æ ‡ç­¾é¡µæŒ‰é’®
3. å®ç°å¯¹åº”çš„åˆçº¦è°ƒç”¨é€»è¾‘

---

## API å‚è€ƒ

### createAccount

```typescript
await writeContract({
  address: contractAddress,
  abi: LighterAccountABI,
  functionName: 'createAccount',
  args: [recipientAddress, nostrPubKeyBytes32],
  value: parseEther(rentAmount),
});
```

### destroyAccount

```typescript
await writeContract({
  address: contractAddress,
  abi: LighterAccountABI,
  functionName: 'destroyAccount',
  args: [tokenId, refundRecipient],
});
```

### upgradeQuota

```typescript
await writeContract({
  address: contractAddress,
  abi: LighterAccountABI,
  functionName: 'upgradeQuota',
  args: [tokenId],
  value: parseEther(upgradeAmount),
});
```

---

## å®‰å…¨æç¤º

1. **å§‹ç»ˆéªŒè¯åˆçº¦åœ°å€**ï¼šåœ¨è¾“å…¥åˆçº¦åœ°å€å‰ï¼Œåœ¨åŒºå—æµè§ˆå™¨ä¸­éªŒè¯
2. **æ£€æŸ¥äº¤æ˜“å‚æ•°**ï¼šåœ¨ç¡®è®¤äº¤æ˜“å‰ä»”ç»†æ£€æŸ¥æ‰€æœ‰å‚æ•°
3. **ä½¿ç”¨æµ‹è¯•ç½‘æµ‹è¯•**ï¼šåœ¨ä¸»ç½‘ä½¿ç”¨å‰ï¼Œå…ˆåœ¨æµ‹è¯•ç½‘å……åˆ†æµ‹è¯•
4. **ä¿ç®¡å¥½ç§é’¥**ï¼šæ°¸è¿œä¸è¦æ³„éœ²æ‚¨çš„ç§é’¥æˆ–åŠ©è®°è¯

---

## ç›¸å…³é“¾æ¥

- **æ™ºèƒ½åˆçº¦**: `../contracts/account/LighterAccount.sol`
- **éƒ¨ç½²è„šæœ¬**: `../scripts/deploy-with-official-accountv3.ts`
- **æµ‹è¯•**: `../test/LighterAccount.ts`

---

## è®¸å¯è¯

MIT

